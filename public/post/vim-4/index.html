<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tips for merging from vim-plug to lazy.nvim | So</title><meta name=keywords content="lazy.nvim,vim,neovim,vim-plug"><meta name=description content="Tips and issue I discovered during mergation. Hope to save someone's time in the future."><meta name=author content="sokinpui"><link rel=canonical href=https://canonical.url/to/page><link crossorigin=anonymous href=/Blog/assets/css/stylesheet.min.d13dc9670c54a799901d8f51eb366234127600b84f76504283993a1e6bb2ffd7.css integrity="sha256-0T3JZwxUp5mQHY9R6zZiNBJ2ALhPdlBCg5k6Hmuy/9c=" rel="preload stylesheet" as=style><link rel=icon href=https://sokinpui.github.io/Blog/favicon.ico><link rel=apple-touch-icon href=https://sokinpui.github.io/Blog/apple-touch-icon.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta name=twitter:card content="summary"><meta name=twitter:title content="Tips for merging from vim-plug to lazy.nvim | So"><meta name=twitter:description content="Tips and issue I discovered during mergation. Hope to save someone's time in the future."><meta property="og:title" content="Tips for merging from vim-plug to lazy.nvim | So"><meta property="og:description" content="Tips and issue I discovered during mergation. Hope to save someone's time in the future."><meta property="og:type" content="article"><meta property="og:url" content="https://sokinpui.github.io/Blog/post/vim-4/"><meta property="og:image" content="https://sokinpui.github.io/Blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-07-29T23:58:37+08:00"><meta property="article:modified_time" content="2023-07-29T23:58:37+08:00"><meta property="og:site_name" content="So's blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://sokinpui.github.io/Blog/post/"},{"@type":"ListItem","position":2,"name":"Tips for merging from vim-plug to lazy.nvim","item":"https://sokinpui.github.io/Blog/post/vim-4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tips for merging from vim-plug to lazy.nvim | So","name":"Tips for merging from vim-plug to lazy.nvim","description":"Tips and issue I discovered during mergation. Hope to save someone's time in the future.","keywords":["lazy.nvim","vim","neovim","vim-plug"],"wordCount":"1584","inLanguage":"en","datePublished":"2023-07-29T23:58:37+08:00","dateModified":"2023-07-29T23:58:37+08:00","author":{"@type":"Person","name":"sokinpui"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://sokinpui.github.io/Blog/post/vim-4/"},"publisher":{"@type":"Organization","name":"So","logo":{"@type":"ImageObject","url":"https://sokinpui.github.io/Blog/favicon.ico"}}}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css integrity=sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js integrity=sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8590906017442858" crossorigin=anonymous></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-post kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://sokinpui.github.io/Blog/ accesskey=h title="So (Alt + H)">So</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://sokinpui.github.io/Blog/archives/ title=Archives>Archives</a></li><li><a href=https://sokinpui.github.io/Blog/post/ title=Post class=active>Post</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sokinpui.github.io/Blog/>Home</a>&nbsp;Â»&nbsp;<a href=https://sokinpui.github.io/Blog/post/>Posts</a></div><h1 class=post-title>Tips for merging from vim-plug to lazy.nvim</h1><div class=post-description>Tips and issue I discovered during mergation. Hope to save someone's time in the future.</div><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>July 29, 2023</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://sokinpui.github.io/Blog/tags/lazy.nvim/>lazy.nvim</a><a href=https://sokinpui.github.io/Blog/tags/vim/>vim</a><a href=https://sokinpui.github.io/Blog/tags/neovim/>neovim</a><a href=https://sokinpui.github.io/Blog/tags/vim-plug/>vim-plug</a></span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>8 min</span></span></div></header><div class="toc side left"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#why-lazynvim aria-label="Why lazy.nvim">Why lazy.nvim</a></li><li><a href=#issue aria-label=issue>issue</a></li><li><a href=#plugins-need-to-take-extra-care-durig-mergation aria-label="plugins need to take extra care durig mergation">plugins need to take extra care durig mergation</a><ul><li><a href=#1-fernvimhttpsgithubcomlambdalisuefernvim aria-label="1. fern.vim">1. <a href=https://github.com/lambdalisue/fern.vim>fern.vim</a></a></li><li><a href=#2-fzfvimhttpsgithubcomjunegunnfzfvim aria-label="2. fzf.vim">2. <a href=https://github.com/junegunn/fzf.vim>fzf.vim</a></a></li><li><a href=#3-visual-multihttpsgithubcommg979vim-visual-multi aria-label="3. visual-multi">3. <a href=https://github.com/mg979/vim-visual-multi>visual-multi</a></a></li><li><a href=#4-auto-pairshttpsgithubcomjiangmiaoauto-pairs aria-label="4. auto-pairs">4. <a href=https://github.com/jiangmiao/auto-pairs>auto-pairs</a></a></li><li><a href=#5-sandwich-vimhttpsgithubcommachakannvim-sandwich aria-label="5. sandwich-vim">5. <a href=https://github.com/machakann/vim-sandwich>sandwich-vim</a></a></li><li><a href=#6-ultisnipshttpsgithubcomsirverultisnips-x-nvim-cmphttpsgithubcomhrsh7thnvim-cmp aria-label="6. Ultisnips x nvim-cmp">6. <a href=https://github.com/SirVer/ultisnips>Ultisnips</a> x <a href=https://github.com/hrsh7th/nvim-cmp>nvim-cmp</a></a></li></ul></li><li><a href=#benefits aria-label=benefits>benefits</a></li><li><a href=#finall-thoughts aria-label="Finall thoughts">Finall thoughts</a></li></ul></div></details></div><div class=post-content><p>Tips and issue I discovered during mergation. Hope to save someone&rsquo;s time in the future.</p><h1 id=why-lazynvim>Why lazy.nvim<a hidden class=anchor aria-hidden=true href=#why-lazynvim>Â¶</a></h1><p>This is a long story, shall we start from another application <a href=https://obsidian.md/>obsidian</a>. I use <strong>obsidian</strong> for notes taking. I want some faster, non-repeative and easier note editing tools, and therefor I use some editor as my obsidian editing engine, in my case, Neovim Setup autocompletion and snippets in Neovim is always easier than same setup on obsidian. In Neovim, we have <a href=https://github.com/neoclide/coc.nvim>coc.nvim</a>, <a href=https://github.com/hrsh7th/nvim-cmp>nvim-cmp</a> and <a href=https://github.com/ms-jpq/coq_nvim>coq_nvim</a> etc&mldr; And you have many snippets source. However, I cannot easily insert link to files as well as link to header in Vim. Although coc.nvim already provide some <a href=https://github.com/neoclide/coc.nvim/wiki/Completion-with-sources#completion-sources>source</a>, lacking obsidian. Then I google for solution, I found <a href=https://github.com/epwalsh/obsidian.nvim>obsidian.nvim</a>, which say it provide link completion source for <strong>nvim-cmp</strong>
<img loading=lazy src=/Blog/post/vim-4/obsidian-nvim.png type alt=obsidian-nvim></p><p>Then I have look at nvim-cmp, It separate autocompletion front end and back end, user have too integrate them manually. In terms of personalization, it provide more free. It terms of out-of-box, it is bad. If only insert link to relative file, <a href=https://github.com/junegunn/fzf.vim>fzf.vim</a> with some tweaks can do so.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=c>&#34;find the root git repo, in case of obsidian, it is the vault</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; insert relative path</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>inoremap</span> <span class=p>&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>l</span><span class=p>&gt;</span> <span class=nx>fzf</span>#<span class=nx>vim</span>#<span class=nx>complete</span>#<span class=nx>path</span><span class=p>(</span>&#39;<span class=nx>fd</span> <span class=p>--</span><span class=nx>type</span><span class=p>=</span><span class=nx>file</span> .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    \ $<span class=p>(</span><span class=nx>git</span> <span class=nx>rev</span><span class=p>-</span><span class=nx>parse</span> <span class=p>--</span><span class=nx>show</span><span class=p>-</span><span class=nx>cdup</span> <span class=m>2</span><span class=p>&gt;</span> <span class=sr>/dev/</span><span class=nx>null</span><span class=p>)</span>&#39;<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; insert full path</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>inoremap</span> <span class=p>&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>f</span><span class=p>&gt;</span> <span class=nx>fzf</span>#<span class=nx>vim</span>#<span class=nx>complete</span>#<span class=nx>path</span><span class=p>(</span>&#39;<span class=nx>fd</span> <span class=p>--</span><span class=nx>type</span><span class=p>=</span><span class=nx>file</span> .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    \ $<span class=p>(</span><span class=nx>git</span> <span class=nx>rev</span><span class=p>-</span><span class=nx>parse</span> <span class=p>--</span><span class=nx>show</span><span class=p>-</span><span class=nx>toplevel</span> <span class=m>2</span><span class=p>&gt;</span> <span class=sr>/dev/</span><span class=nx>null</span><span class=p>)</span>&#39;<span class=p>)</span><span class=err>
</span></span></span></code></pre></div><p>But too much tweaks for insert header as smooth as obsidian.</p><p>So, I try nvim-cmp, I just find that many of Neovim specify plugins have to configurate in lua, it should be easier to manage those plugin with some Neovim plugin manager like <a href=https://github.com/folke/lazy.nvim>lavy.nvim</a>. (Many lua plugins provide snippets for installation and configuration at the same place, but require lazy.nvim or packer.nvim) Then, this is the beginning of this blog.</p><h1 id=issue>issue<a hidden class=anchor aria-hidden=true href=#issue>Â¶</a></h1><p>can&rsquo;t use pack anymore
require dependency if this is some plugins of plugins.</p><p>Lazy.nvim will and need to manage all your plugin, see the description from <strong>lazy.nvim</strong></p><blockquote><p>lazy.nvim does NOT use Neovim packages and even disables plugin loading completely (vim.go.loadplugins = false). It takes over the complete startup sequence for more flexibility and better performance.
In practice this means that step 10 of Neovim Initialization is done by Lazy:</p><p>All the plugins&rsquo; init() functions are executed
All plugins with lazy=false are loaded. This includes sourcing /plugin and /ftdetect files. (/after will not be sourced yet)
All files from /plugin and /ftdetect directories in you rtp are sourced (excluding /after)
All /after/plugin files are sourced (this includes /after from plugins)</p><p>Files from runtime directories are always sourced in alphabetical order.
So all the plugins installed with vim built-in plugins will not be loaded, or you have to add extra options when you calling:</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=n>dir</span><span class=o>=</span><span class=s1>&#39;~/config/nvim/pack/*/start/Plugin&#39;</span><span class=p>,</span> <span class=n>config</span><span class=o>=</span><span class=kc>true</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>when return the plugin table spec to <strong>lazy.nvim</strong>, if you use pack directory to manage personal scirpt or plugins like me, you have to consider move those plugins into your <code>$NVIMRUNTIMPATH</code> <code>~/.confg/nvim</code>. I merge them with simple bash script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>moveToRtp(){
</span></span><span class=line><span class=cl>  for plugindir in $*; do
</span></span><span class=line><span class=cl>    cd $plugindir
</span></span><span class=line><span class=cl>    for file in $(find . -type f)
</span></span><span class=line><span class=cl>      rtp=$(echo $(echo $file | sed &#34;s/\.\///&#34;) | sed &#34;s/\/.*$//&#34;)
</span></span><span class=line><span class=cl>      cp file &#34;~/.config/nvim/$rtp&#34;
</span></span><span class=line><span class=cl>    cd ..
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>moveToRtp Plugin1 Plugin2 Plugin3 ...
</span></span></code></pre></div><p>This simple script will can move plugins don&rsquo;t contain <code>/after/*</code>. I just merge <code>/after/*</code> manually.</p><h1 id=plugins-need-to-take-extra-care-durig-mergation>plugins need to take extra care durig mergation<a hidden class=anchor aria-hidden=true href=#plugins-need-to-take-extra-care-durig-mergation>Â¶</a></h1><p>Some plugins configuration need special care when configure with <strong>lazy.nvim</strong>. Most of the case I found related to plugins&rsquo; compability with <em>lua</em>, I would recommend if the confiuration is already in vimscript, keep going with vimscript if you don&rsquo;t care performance loss(actually I don&rsquo;t know how much loss, maybe it is ignorable)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;some/plugin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>vim.cmd</span><span class=p>(</span><span class=s>[[
</span></span></span><span class=line><span class=cl><span class=s>            let g:plguinSettings = &#34;...&#34;
</span></span></span><span class=line><span class=cl><span class=s>            noremap &lt;C-j&gt; &lt;Plug&gt;(plugin-do-something)
</span></span></span><span class=line><span class=cl><span class=s>        ]]</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It should solve most of the problem and save time during mergation because you can avoid rewrite all configuration in lua when vim plugins usually provide vimscript api for configuration. Due to the difference between data structure of vimscript and lua, <code>vim.g.setttingAPI = "..."</code> may not always work.</p><h2 id=1-fernvimhttpsgithubcomlambdalisuefernvim>1. <a href=https://github.com/lambdalisue/fern.vim>fern.vim</a><a hidden class=anchor aria-hidden=true href=#1-fernvimhttpsgithubcomlambdalisuefernvim>Â¶</a></h2><blockquote><p>Fern (furn) is a general purpose asynchronous tree viewer written in pure Vim script.
If you use fern with some <a href=https://github.com/lambdalisue/fern.vim/wiki/Plugins>external plugins</a>, you should remember add them as dependency of <strong>fern.vim</strong>:</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;lambdalisue/fern.vim&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>dependencies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;lambdalisue/fern-hijack.vim&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;lambdalisue/fern-mapping-project-top.vim&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sokinpui/my-fern-preview.vim&#34;</span><span class=p>,</span>    
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Otherwise, you may see error like:
<img loading=lazy src=/Blog/post/vim-4/fern-issue.png type alt=fern-issue.png></p><h2 id=2-fzfvimhttpsgithubcomjunegunnfzfvim>2. <a href=https://github.com/junegunn/fzf.vim>fzf.vim</a><a hidden class=anchor aria-hidden=true href=#2-fzfvimhttpsgithubcomjunegunnfzfvim>Â¶</a></h2><p>If install <strong>fzf.vim</strong> with vim-plug, I don&rsquo;t have to install <a href=https://github.com/junegunn/fzf>fzf</a> if I have install fzf locally outside vim. However, you should do so in <strong>lazy.nvim</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;junegunn/fzf.vim&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>build</span> <span class=o>=</span> <span class=s2>&#34;./install --all&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;junegunn/fzf&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Otherwise, error again:
<img loading=lazy src=/Blog/post/vim-4/fzf.vim.png type alt=fzf></p><h2 id=3-visual-multihttpsgithubcommg979vim-visual-multi>3. <a href=https://github.com/mg979/vim-visual-multi>visual-multi</a><a hidden class=anchor aria-hidden=true href=#3-visual-multihttpsgithubcommg979vim-visual-multi>Â¶</a></h2><p>It is a mulit cursor plugin for Vim. If you remap key like me, I remap <code>s</code> to <code>c</code> in multi-cursor mode. In lua, you should use</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;mg979/vim-visual-multi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>branch</span> <span class=o>=</span> <span class=s2>&#34;master&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>vim.g</span><span class=p>.</span><span class=n>VM_custom_remaps</span> <span class=o>=</span> <span class=p>{</span> <span class=n>s</span> <span class=o>=</span> <span class=s1>&#39;c&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>instead of <code>let g:VM_custom_remaps = { 's' = 'c' }</code> in vimscript.</p><h2 id=4-auto-pairshttpsgithubcomjiangmiaoauto-pairs>4. <a href=https://github.com/jiangmiao/auto-pairs>auto-pairs</a><a hidden class=anchor aria-hidden=true href=#4-auto-pairshttpsgithubcomjiangmiaoauto-pairs>Â¶</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;LunarWatcher/auto-pairs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>vim.g</span><span class=p>.</span><span class=n>AutoPairs</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;(&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;[&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;]&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;{&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;&#39;&#39;] = &#39;&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;&#34;&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#34;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;`&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;`&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;&lt;!--&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;--&gt;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;/*&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;*/&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;```&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;```&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s1>&#39;&#34;&#34;&#34;&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#34;&#34;&#34;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span><span class=s2>&#34;&#39;&#39;&#39;&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;&#39;&#39;&#39;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Since offical version in vimscript is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=k>let</span> <span class=nx>g</span>:<span class=nx>AutoPairs</span> <span class=p>=</span> {<span class=s1>&#39;(&#39;</span>:<span class=s1>&#39;)&#39;</span><span class=p>,</span> <span class=s1>&#39;[&#39;</span>:<span class=s1>&#39;]&#39;</span><span class=p>,</span> <span class=s1>&#39;{&#39;</span>:<span class=s1>&#39;}&#39;</span><span class=p>,</span><span class=s2>&#34;&#39;&#34;</span>:<span class=s2>&#34;&#39;&#34;</span><span class=p>,</span><span class=s1>&#39;&#34;&#39;</span>:<span class=s1>&#39;&#34;&#39;</span><span class=p>,</span> <span class=s2>&#34;`&#34;</span>:<span class=s2>&#34;`&#34;</span><span class=p>,</span> <span class=s1>&#39;&lt;!--&#39;</span>:<span class=s1>&#39;--&gt;&#39;</span><span class=p>,</span> <span class=s1>&#39;/*&#39;</span>:<span class=s1>&#39;*/&#39;</span><span class=p>,</span> <span class=s1>&#39;```&#39;</span>:<span class=s1>&#39;```&#39;</span><span class=p>,</span> <span class=s1>&#39;&#34;&#34;&#34;&#39;</span>:<span class=s1>&#39;&#34;&#34;&#34;&#39;</span><span class=p>,</span> <span class=s2>&#34;&#39;&#39;&#39;&#34;</span>:<span class=s2>&#34;&#39;&#39;&#39;&#34;</span>}<span class=err>
</span></span></span></code></pre></div><h2 id=5-sandwich-vimhttpsgithubcommachakannvim-sandwich>5. <a href=https://github.com/machakann/vim-sandwich>sandwich-vim</a><a hidden class=anchor aria-hidden=true href=#5-sandwich-vimhttpsgithubcommachakannvim-sandwich>Â¶</a></h2><p>I don&rsquo;t know why <code>g:sandwich_no_default_key_mappings</code> cannnot set via <strong>Lazy.nvim</strong> with lua. I have to do so to take configuration work</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>M</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>M.config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;machakann/vim-sandwich&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vim.cmd</span><span class=p>(</span><span class=s>[[
</span></span></span><span class=line><span class=cl><span class=s>let g:sandwich_no_default_key_mappings = 1
</span></span></span><span class=line><span class=cl><span class=s>&#34; my mapping
</span></span></span><span class=line><span class=cl><span class=s>...
</span></span></span><span class=line><span class=cl><span class=s>...
</span></span></span><span class=line><span class=cl><span class=s>]]</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>M</span>
</span></span></code></pre></div><p>and then in <code>init.lua</code>, I should call this block with.config</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>require(&#34;lazy&#34;).setup({
</span></span><span class=line><span class=cl>    require(&#34;plugins.sandwich&#34;).config,
</span></span><span class=line><span class=cl>},{})
</span></span></code></pre></div><h2 id=6-ultisnipshttpsgithubcomsirverultisnips-x-nvim-cmphttpsgithubcomhrsh7thnvim-cmp>6. <a href=https://github.com/SirVer/ultisnips>Ultisnips</a> x <a href=https://github.com/hrsh7th/nvim-cmp>nvim-cmp</a><a hidden class=anchor aria-hidden=true href=#6-ultisnipshttpsgithubcomsirverultisnips-x-nvim-cmphttpsgithubcomhrsh7thnvim-cmp>Â¶</a></h2><p>The <code>tab</code> will sucks if you have setting wrong, this part is the most time-consumming part to debug, I nearly give up with nvim-cmp because of its bad properties.</p><p>In <strong>Ultisnips</strong>, you can change the key for expand and jump, since I don&rsquo;t like press <code>&lt;CR></code> to confirm completion selection, I use <code>&lt;C-j></code> to expand and jump forward in snips, <code>&lt;C-k></code> to jump backward.</p><p>At the beginning, I try follow plugin table spec for nvim-cmp:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>M</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>M.config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;SirVer/ultisnips&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;hrsh7th/nvim-cmp&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>dependencies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;hrsh7th/cmp-buffer&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;FelipeLema/cmp-async-path&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;hrsh7th/cmp-nvim-lsp&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=c1>--&#39;hrsh7th/cmp-cmdline&#39;,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;hrsh7th/cmp-calc&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;onsails/lspkind-nvim&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;quangnguyen30192/cmp-nvim-ultisnips&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=c1>-- optional call to setup (see customization section)</span>
</span></span><span class=line><span class=cl>                    <span class=n>require</span><span class=p>(</span><span class=s2>&#34;cmp_nvim_ultisnips&#34;</span><span class=p>).</span><span class=n>setup</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>                <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>after</span> <span class=o>=</span> <span class=s2>&#34;SirVer/ultisnips&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kd>local</span> <span class=n>has_words_before</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=kd>local</span> <span class=n>line</span><span class=p>,</span> <span class=n>col</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_win_get_cursor</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=kr>return</span> <span class=n>col</span> <span class=o>~=</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_buf_get_lines</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>line</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>line</span><span class=p>,</span> <span class=kc>true</span><span class=p>)[</span><span class=mi>1</span><span class=p>]:</span><span class=n>sub</span><span class=p>(</span><span class=n>col</span><span class=p>,</span> <span class=n>col</span><span class=p>):</span><span class=n>match</span><span class=p>(</span><span class=s2>&#34;%s&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>            <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsExpandTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-j&gt;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsJumpForwardTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-j&gt;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsJumpBackwardTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-k&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kd>local</span> <span class=n>cmp</span> <span class=o>=</span> <span class=n>require</span> <span class=s1>&#39;cmp&#39;</span>
</span></span><span class=line><span class=cl>            <span class=c1>--local lspkind = require(&#39;lspkind&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>cmp.setup</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>snippet</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>expand</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>vim.fn</span><span class=p>[</span><span class=s2>&#34;UltiSnips#Anon&#34;</span><span class=p>](</span><span class=n>args.body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>sources</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;buffer&#39;</span> <span class=p>,</span> <span class=n>keyword_length</span> <span class=o>=</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span> <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;nvim_lsp&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span> <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;ultisnips&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=c1>--{ name = &#39;cmdline&#39; },</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span> <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;async_path&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span> <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;calc&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>mapping</span> <span class=o>=</span> <span class=n>cmp.mapping</span><span class=p>.</span><span class=n>preset.insert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=p>[</span><span class=s2>&#34;&lt;Tab&gt;&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cmp.mapping</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=n>i</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>fallback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=kr>if</span> <span class=n>cmp.visible</span><span class=p>()</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>                                <span class=n>cmp.select_next_item</span><span class=p>({</span> <span class=n>behavior</span> <span class=o>=</span> <span class=n>cmp.SelectBehavior</span><span class=p>.</span><span class=n>Insert</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>                            <span class=kr>elseif</span> <span class=n>has_words_before</span><span class=p>()</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>                                <span class=n>cmp.complete</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                            <span class=kr>else</span>
</span></span><span class=line><span class=cl>                                <span class=n>fallback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                            <span class=kr>end</span>
</span></span><span class=line><span class=cl>                        <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>}),</span>
</span></span><span class=line><span class=cl>                    <span class=p>[</span><span class=s2>&#34;&lt;S-Tab&gt;&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cmp.mapping</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=n>i</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>fallback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=kr>if</span> <span class=n>cmp.visible</span><span class=p>()</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>                                <span class=n>cmp.select_prev_item</span><span class=p>({</span> <span class=n>behavior</span> <span class=o>=</span> <span class=n>cmp.SelectBehavior</span><span class=p>.</span><span class=n>Insert</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>                            <span class=kr>else</span>
</span></span><span class=line><span class=cl>                                <span class=n>fallback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                            <span class=kr>end</span>
</span></span><span class=line><span class=cl>                        <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>}),</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>M</span>
</span></span></code></pre></div><p>Pay attention with this three line</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsExpandTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-j&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsJumpForwardTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-j&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsJumpBackwardTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-k&gt;&#34;</span>
</span></span></code></pre></div><p>No matter in lua or in vimscript</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=k>let</span> <span class=nx>g</span>:<span class=nx>UltiSnipsExpandTrigger</span> <span class=p>=</span> <span class=s2>&#34;&lt;C-j&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>UltiSnipsJumpForwardTrigger</span> <span class=p>=</span> <span class=s2>&#34;&lt;C-j&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>UltiSnipsJumpBackwardTrigger</span> <span class=p>=</span> <span class=s2>&#34;&lt;C-k&gt;&#34;</span><span class=err>
</span></span></span></code></pre></div><p>The tab will break, I don&rsquo;t know why, with above three lines, tab will act like:
<img loading=lazy src=/Blog/post/vim-4/snips_jump.gif type alt=snip_jump1></p><p>However, if those three line is out of management of <strong>lazy.nvim</strong>, the tab just work!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>M</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>M.config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;SirVer/ultisnips&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;hrsh7th/nvim-cmp&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>dependencies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;hrsh7th/cmp-buffer&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;FelipeLema/cmp-async-path&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;hrsh7th/cmp-nvim-lsp&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=c1>--&#39;hrsh7th/cmp-cmdline&#39;,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;hrsh7th/cmp-calc&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;onsails/lspkind-nvim&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;quangnguyen30192/cmp-nvim-ultisnips&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=c1>-- optional call to setup (see customization section)</span>
</span></span><span class=line><span class=cl>                    <span class=n>require</span><span class=p>(</span><span class=s2>&#34;cmp_nvim_ultisnips&#34;</span><span class=p>).</span><span class=n>setup</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>                <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>after</span> <span class=o>=</span> <span class=s2>&#34;SirVer/ultisnips&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kd>local</span> <span class=n>has_words_before</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=kd>local</span> <span class=n>line</span><span class=p>,</span> <span class=n>col</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_win_get_cursor</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=kr>return</span> <span class=n>col</span> <span class=o>~=</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_buf_get_lines</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>line</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>line</span><span class=p>,</span> <span class=kc>true</span><span class=p>)[</span><span class=mi>1</span><span class=p>]:</span><span class=n>sub</span><span class=p>(</span><span class=n>col</span><span class=p>,</span> <span class=n>col</span><span class=p>):</span><span class=n>match</span><span class=p>(</span><span class=s2>&#34;%s&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>            <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kd>local</span> <span class=n>cmp</span> <span class=o>=</span> <span class=n>require</span> <span class=s1>&#39;cmp&#39;</span>
</span></span><span class=line><span class=cl>            <span class=c1>--local lspkind = require(&#39;lspkind&#39;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>cmp.setup</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>snippet</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>expand</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>vim.fn</span><span class=p>[</span><span class=s2>&#34;UltiSnips#Anon&#34;</span><span class=p>](</span><span class=n>args.body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>sources</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;buffer&#39;</span> <span class=p>,</span> <span class=n>keyword_length</span> <span class=o>=</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span> <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;nvim_lsp&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span> <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;ultisnips&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=c1>--{ name = &#39;cmdline&#39; },</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span> <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;async_path&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>{</span> <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;calc&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>mapping</span> <span class=o>=</span> <span class=n>cmp.mapping</span><span class=p>.</span><span class=n>preset.insert</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=p>[</span><span class=s2>&#34;&lt;Tab&gt;&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cmp.mapping</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=n>i</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>fallback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=kr>if</span> <span class=n>cmp.visible</span><span class=p>()</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>                                <span class=n>cmp.select_next_item</span><span class=p>({</span> <span class=n>behavior</span> <span class=o>=</span> <span class=n>cmp.SelectBehavior</span><span class=p>.</span><span class=n>Insert</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>                            <span class=kr>elseif</span> <span class=n>has_words_before</span><span class=p>()</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>                                <span class=n>cmp.complete</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                            <span class=kr>else</span>
</span></span><span class=line><span class=cl>                                <span class=n>fallback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                            <span class=kr>end</span>
</span></span><span class=line><span class=cl>                        <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>}),</span>
</span></span><span class=line><span class=cl>                    <span class=p>[</span><span class=s2>&#34;&lt;S-Tab&gt;&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cmp.mapping</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=n>i</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>fallback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=kr>if</span> <span class=n>cmp.visible</span><span class=p>()</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>                                <span class=n>cmp.select_prev_item</span><span class=p>({</span> <span class=n>behavior</span> <span class=o>=</span> <span class=n>cmp.SelectBehavior</span><span class=p>.</span><span class=n>Insert</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>                            <span class=kr>else</span>
</span></span><span class=line><span class=cl>                                <span class=n>fallback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                            <span class=kr>end</span>
</span></span><span class=line><span class=cl>                        <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>}),</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsExpandTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-j&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsJumpForwardTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-j&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>vim.g</span><span class=p>.</span><span class=n>UltiSnipsJumpBackwardTrigger</span> <span class=o>=</span> <span class=s2>&#34;&lt;C-k&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>M</span>
</span></span></code></pre></div><p>Everythin just work!
<img loading=lazy src=/Blog/post/vim-4/snipe_jump_right.gif type alt=snip-jump2></p><h1 id=benefits>benefits<a hidden class=anchor aria-hidden=true href=#benefits>Â¶</a></h1><p>The plugins is more structured, so navigation and group plugins is easier than <strong>vim-plug</strong>, with some <strong>plugin</strong> like <strong>fzf.vim</strong>, I can easily jump to file I want, and separate plugin config into different files according to their purpose. Before using <strong>lazy.nvim</strong> all plugins config are store in the same file call <code>plugins.vim</code>, now modualize like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>âââ config
</span></span><span class=line><span class=cl>âÂ Â  âââ lualine.lua
</span></span><span class=line><span class=cl>âââ lazy-init.lua
</span></span><span class=line><span class=cl>âââ plugins
</span></span><span class=line><span class=cl>    âââ autocompletion.lua
</span></span><span class=line><span class=cl>    âââ cleverf.lua
</span></span><span class=line><span class=cl>    âââ colorscheme.lua
</span></span><span class=line><span class=cl>    âââ fern.lua
</span></span><span class=line><span class=cl>    âââ fzf.lua
</span></span><span class=line><span class=cl>    âââ lsp.lua
</span></span><span class=line><span class=cl>    âââ markdown.lua
</span></span><span class=line><span class=cl>    âââ multi_cursor.lua
</span></span><span class=line><span class=cl>    âââ nerdfont.lua
</span></span><span class=line><span class=cl>    âââ pairs.lua
</span></span><span class=line><span class=cl>    âââ sandwich.lua
</span></span><span class=line><span class=cl>    âââ treesitter.lua
</span></span></code></pre></div><h1 id=finall-thoughts>Finall thoughts<a hidden class=anchor aria-hidden=true href=#finall-thoughts>Â¶</a></h1><p>As most of plugin I used are written for both Vim and Neovim, most of them are still providing vimscript api to config, there are only some little surprise issue from prefect.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://sokinpui.github.io/Blog/post/vim/vim1-usingvimintro/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Another attribute to use Vim</span></a>
<a class=next href=https://sokinpui.github.io/Blog/post/vim-3/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Vim Plugins introduction</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2023 <a href=https://sokinpui.github.io/Blog/>So</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a></span>
<span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n="1"=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/Blog/js/medium-zoom.min.js data-no-instant></script>
<script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script><script src=/Blog/js/instantclick.min.js data-no-instant></script>
<script data-no-instant>InstantClick.init()</script></body></html>